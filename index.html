<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü¶Ä Rust Raid System</title>
    <meta name="description" content="–°–∏—Å—Ç–µ–º–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π –¥–ª—è Rust –∫–æ–º–∞–Ω–¥">
    
    <!-- PWA –º–∞–Ω–∏—Ñ–µ—Å—Ç -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#8B4513">
    
    <!-- –ò–∫–æ–Ω–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #8B4513, #CD853F, #8B4513);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            border: 2px solid #FFD700;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .subtitle {
            font-size: 14px;
            color: #f4e4bc;
            margin-bottom: 5px;
        }

        .by-rkn {
            font-size: 12px;
            color: #FFD700;
            font-style: italic;
        }

        .connection-status {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid #10b981;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .status-online {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.2);
        }

        .status-offline {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.2);
        }

        .team-section {
            background: rgba(139, 69, 19, 0.3);
            border: 2px solid #8B4513;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .team-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .team-code {
            background: rgba(0,0,0,0.3);
            padding: 8px 12px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 16px;
            color: #FFD700;
            margin: 10px 0;
            text-align: center;
            border: 1px solid #FFD700;
            cursor: pointer;
        }

        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .action-button {
            background: #dc2626;
            border: none;
            border-radius: 10px;
            padding: 20px 10px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            border: 2px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .action-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .action-button.blue { background: #2563eb; }
        .action-button.green { background: #16a34a; }
        .action-button.purple { background: #7c3aed; }
        .action-button.orange { background: #ea580c; }
        .action-button.brown { background: #7c2d12; }

        .emergency-button {
            background: #dc2626;
            border: 3px solid #ff0000;
            border-radius: 10px;
            padding: 20px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }

        .modal-content {
            background: #8B4513;
            margin: 10% auto;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            border: 2px solid #FFD700;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .input {
            width: 100%;
            padding: 12px;
            border: 1px solid #8B4513;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 16px;
            background: rgba(255,255,255,0.9);
            color: #8B4513;
        }

        .textarea {
            min-height: 80px;
            resize: vertical;
        }

        .submit-button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            border: 2px solid #FFD700;
        }

        .cancel-button {
            background: transparent;
            color: #f4e4bc;
            border: none;
            padding: 15px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
        }

        .notification {
            background: rgba(0,0,0,0.3);
            border-left: 4px solid #FFD700;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            animation: slideIn 0.3s ease;
        }

        .notification.urgent {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.2);
            animation: pulse 1s infinite;
        }

        .notification-type {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .notification-message {
            font-size: 14px;
            color: #f4e4bc;
            margin-bottom: 5px;
        }

        .notification-details {
            font-size: 12px;
            color: #d4af37;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 215, 0, 0.3);
        }

        .footer-text {
            font-size: 14px;
            color: #FFD700;
            font-weight: bold;
        }

        .footer-subtext {
            font-size: 12px;
            color: #f4e4bc;
            margin-top: 2px;
            font-style: italic;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .button-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="header">
            <div class="title">ü¶Ä RUST RAID SYSTEM</div>
            <div class="subtitle">–°–∏—Å—Ç–µ–º–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π –¥–ª—è Rust</div>
            <div class="by-rkn">by RKN</div>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
        <div class="connection-status" id="connectionStatus">
            <div id="statusText">üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...</div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–∞–Ω–¥–µ -->
        <div class="team-section" id="teamInfo" style="display: none;">
            <div class="team-name" id="teamName">üè¥ –ú–æ—è –∫–æ–º–∞–Ω–¥–∞</div>
            <div>üñ•Ô∏è –°–µ—Ä–≤–µ—Ä: <span id="serverName">Demo Server</span></div>
            <div>üë• –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: <span id="memberCount">1</span></div>
            <div class="team-code" id="teamCode" onclick="copyTeamCode()">ABC123</div>
            <div style="font-size: 12px; color: #f4e4bc; text-align: center;">
                üëÜ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ–¥ —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ -->
        <div class="button-grid">
            <button class="action-button" onclick="sendRaidAlert('online-raid')" id="raidBtn" disabled>
                <div style="font-size: 20px; margin-bottom: 5px;">‚öîÔ∏è</div>
                –û–ù–õ–ê–ô–ù –†–ï–ô–î
            </button>

            <button class="action-button brown" onclick="sendRaidAlert('offline-raid')" id="offlineRaidBtn" disabled>
                <div style="font-size: 20px; margin-bottom: 5px;">üåô</div>
                –û–§–§–õ–ê–ô–ù –†–ï–ô–î
            </button>

            <button class="action-button orange" onclick="sendRaidAlert('counter-raid')" id="counterRaidBtn" disabled>
                <div style="font-size: 20px; margin-bottom: 5px;">üõ°Ô∏è</div>
                –ö–ê–£–ù–¢–ï–† –†–ï–ô–î
            </button>

            <button class="action-button green" onclick="sendFarmAlert()" id="farmBtn" disabled>
                <div style="font-size: 20px; margin-bottom: 5px;">‚õèÔ∏è</div>
                –§–ê–†–ú –ó–ê–ë–ï–ì
            </button>

            <button class="action-button blue" onclick="openModal('createModal')">
                <div style="font-size: 20px; margin-bottom: 5px;">üè¥</div>
                –°–û–ó–î–ê–¢–¨ –ö–û–ú–ê–ù–î–£
            </button>

            <button class="action-button purple" onclick="openModal('joinModal')">
                <div style="font-size: 20px; margin-bottom: 5px;">üë•</div>
                –ü–†–ò–°–û–ï–î–ò–ù–ò–¢–¨–°–Ø
            </button>
        </div>

        <!-- –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ -->
        <button class="emergency-button pulse" onclick="sendDefenseAlert()" id="defenseBtn" disabled>
            <div style="font-size: 20px; margin-bottom: 5px;">üö®</div>
            –ë–ê–ó–ê –ü–û–î –ê–¢–ê–ö–û–ô!
        </button>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="notifications" style="display: none;">
            <h3 style="margin-bottom: 15px;">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã</h3>
            <div id="notificationsList"></div>
        </div>

        <!-- –ü–æ–¥–ø–∏—Å—å -->
        <div class="footer">
            <div class="footer-text">–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ by RKN</div>
            <div class="footer-subtext">–î–ª—è Rust –∏–≥—Ä–æ–∫–æ–≤ ü¶Ä</div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    
    <!-- –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã -->
    <div id="createModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">üè¥ –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É</div>
            <input type="text" class="input" id="teamNameInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã">
            <input type="text" class="input" id="userNameInput" placeholder="–í–∞—à –∏–≥—Ä–æ–≤–æ–π –Ω–∏–∫">
            <input type="text" class="input" id="serverNameInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞">
            <button class="submit-button" onclick="createTeam()">üè¥ –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É</button>
            <button class="cancel-button" onclick="closeModal('createModal')">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–∞–Ω–¥–µ -->
    <div id="joinModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">üë• –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–∞–Ω–¥–µ</div>
            <input type="text" class="input" id="joinCodeInput" placeholder="–ö–æ–¥ –∫–æ–º–∞–Ω–¥—ã" style="text-transform: uppercase;">
            <input type="text" class="input" id="joinNameInput" placeholder="–í–∞—à –∏–≥—Ä–æ–≤–æ–π –Ω–∏–∫">
            <button class="submit-button" onclick="joinTeam()">üë• –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
            <button class="cancel-button" onclick="closeModal('joinModal')">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- Socket.IO -->
    <script src="/socket.io/socket.io.js"></script>
    
    <script>
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let socket;
        let currentTeam = null;
        let currentUser = null;
        let notifications = [];
        let isConnected = false;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            initializeApp();
            setupPushNotifications();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initializeApp() {
            // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
            socket = io();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
            socket.on('connect', () => {
                isConnected = true;
                updateConnectionStatus('üü¢ –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É', 'status-online');
                console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É');
            });

            socket.on('disconnect', () => {
                isConnected = false;
                updateConnectionStatus('üî¥ –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'status-offline');
                console.log('–û—Ç–∫–ª—é—á–µ–Ω –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            socket.on('raid-notification', (data) => {
                handleRaidNotification(data);
            });

            socket.on('defense-notification', (data) => {
                handleDefenseNotification(data);
            });

            socket.on('member-joined', (data) => {
                showLocalNotification(`üë• ${data.userName} –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –∫–æ–º–∞–Ω–¥–µ`);
            });

            socket.on('member-left', (data) => {
                showLocalNotification(`üë• ${data.userName} –ø–æ–∫–∏–Ω—É–ª –∫–æ–º–∞–Ω–¥—É`);
            });

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            loadStoredData();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        function updateConnectionStatus(text, className) {
            const statusElement = document.getElementById('connectionStatus');
            const textElement = document.getElementById('statusText');
            
            textElement.textContent = text;
            statusElement.className = `connection-status ${className}`;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function loadStoredData() {
            const storedTeam = localStorage.getItem('rustTeam');
            const storedUser = localStorage.getItem('rustUser');

            if (storedTeam && storedUser) {
                currentTeam = JSON.parse(storedTeam);
                currentUser = JSON.parse(storedUser);
                
                updateTeamDisplay();
                enableTeamButtons();
                
                // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ –∫–æ–º–∞–Ω–¥–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                if (isConnected) {
                    socket.emit('join-team', {
                        teamCode: currentTeam.code,
                        userName: currentUser.name
                    });
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
        function updateTeamDisplay() {
            if (currentTeam) {
                document.getElementById('teamInfo').style.display = 'block';
                document.getElementById('teamName').textContent = `üè¥ ${currentTeam.name}`;
                document.getElementById('serverName').textContent = currentTeam.server;
                document.getElementById('memberCount').textContent = currentTeam.members.length;
                document.getElementById('teamCode').textContent = currentTeam.code;
            }
        }

        // –í–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –∫–æ–º–∞–Ω–¥—ã
        function enableTeamButtons() {
            const buttons = ['raidBtn', 'offlineRaidBtn', 'counterRaidBtn', 'farmBtn', 'defenseBtn'];
            buttons.forEach(id => {
                document.getElementById(id).disabled = false;
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
        async function createTeam() {
            const teamName = document.getElementById('teamNameInput').value.trim();
            const userName = document.getElementById('userNameInput').value.trim();
            const serverName = document.getElementById('serverNameInput').value.trim();

            if (!teamName || !userName || !serverName) {
                alert('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            try {
                const response = await fetch('/api/create-team', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ teamName, serverName, leaderName: userName })
                });

                const data = await response.json();
                
                if (data.success) {
                    const newTeam = {
                        id: data.teamCode,
                        name: teamName,
                        code: data.teamCode,
                        server: serverName,
                        members: [{ name: userName, isOnline: true }],
                        leader: userName
                    };

                    currentTeam = newTeam;
                    currentUser = { name: userName, isOnline: true };

                    localStorage.setItem('rustTeam', JSON.stringify(newTeam));
                    localStorage.setItem('rustUser', JSON.stringify(currentUser));

                    updateTeamDisplay();
                    enableTeamButtons();
                    closeModal('createModal');

                    // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ –∫–æ–º–∞–Ω–¥–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                    socket.emit('join-team', {
                        teamCode: data.teamCode,
                        userName: userName
                    });

                    alert(`ü¶Ä –ö–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞–Ω–∞!\n\n–°–µ—Ä–≤–µ—Ä: ${serverName}\n–ö–æ–¥ –∫–æ–º–∞–Ω–¥—ã: ${data.teamCode}\n\n–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –∫–æ–¥–æ–º —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏!`);
                    
                    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
                    document.getElementById('teamNameInput').value = '';
                    document.getElementById('userNameInput').value = '';
                    document.getElementById('serverNameInput').value = '';
                }
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã');
                console.error(error);
            }
        }

        // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–∞–Ω–¥–µ
        function joinTeam() {
            const teamCode = document.getElementById('joinCodeInput').value.trim().toUpperCase();
            const userName = document.getElementById('joinNameInput').value.trim();

            if (!teamCode || !userName) {
                alert('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            const newTeam = {
                id: teamCode,
                name: `–ö–æ–º–∞–Ω–¥–∞ ${teamCode}`,
                code: teamCode,
                server: '–°–µ—Ä–≤–µ—Ä –∫–æ–º–∞–Ω–¥—ã',
                members: [{ name: userName, isOnline: true }],
                leader: userName
            };

            currentTeam = newTeam;
            currentUser = { name: userName, isOnline: true };

            localStorage.setItem('rustTeam', JSON.stringify(newTeam));
            localStorage.setItem('rustUser', JSON.stringify(currentUser));

            updateTeamDisplay();
            enableTeamButtons();
            closeModal('joinModal');

            // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ –∫–æ–º–∞–Ω–¥–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
            socket.emit('join-team', {
                teamCode: teamCode,
                userName: userName
            });

            alert(`‚úÖ –£—Å–ø–µ—à–Ω–æ!\n\n–í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –∫–æ–º–∞–Ω–¥–µ —Å –∫–æ–¥–æ–º: ${teamCode}`);
            
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            document.getElementById('joinCodeInput').value = '';
            document.getElementById('joinNameInput').value = '';
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–π–¥-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function sendRaidAlert(type) {
            if (!currentTeam || !currentUser || !isConnected) {
                alert('‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É –∏–ª–∏ –∫–æ–º–∞–Ω–¥–µ');
                return;
            }

            const message = prompt(`–í–≤–µ–¥–∏—Ç–µ –¥–µ—Ç–∞–ª–∏ ${type === 'online-raid' ? '–æ–Ω–ª–∞–π–Ω' : type === 'offline-raid' ? '–æ—Ñ—Ñ–ª–∞–π–Ω' : '–∫–∞—É–Ω—Ç–µ—Ä'} —Ä–µ–π–¥–∞:`);
            if (!message) return;

            const coords = prompt('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: G15):') || '';

            socket.emit('raid-alert', {
                teamCode: currentTeam.code,
                message: message,
                coords: coords,
                type: type,
                sender: currentUser.name
            });

            showLocalNotification(`üö® ${type.toUpperCase()} –†–ï–ô–î –û–ë–™–Ø–í–õ–ï–ù!\n\n${message}${coords ? `\n–ö–æ–æ—Ä–¥—ã: ${coords}` : ''}`);
        }

        // –§–∞—Ä–º –∑–∞–±–µ–≥
        function sendFarmAlert() {
            if (!currentTeam || !currentUser || !isConnected) {
                alert('‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É –∏–ª–∏ –∫–æ–º–∞–Ω–¥–µ');
                return;
            }

            socket.emit('raid-alert', {
                teamCode: currentTeam.code,
                message: '–°–±–æ—Ä –Ω–∞ —Ñ–∞—Ä–º —Ä–µ—Å—É—Ä—Å–æ–≤! –ù—É–∂–Ω—ã –≤—Å–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ –∏–≥—Ä–æ–∫–∏.',
                coords: '',
                type: 'farm',
                sender: currentUser.name
            });

            showLocalNotification('‚õèÔ∏è –§–ê–†–ú –ó–ê–ë–ï–ì!\n\n–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ñ–∞—Ä–º–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º');
        }

        // –ó–∞—â–∏—Ç–∞ –±–∞–∑—ã
        function sendDefenseAlert() {
            if (!currentTeam || !currentUser || !isConnected) {
                alert('‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É –∏–ª–∏ –∫–æ–º–∞–Ω–¥–µ');
                return;
            }

            socket.emit('defense-alert', {
                teamCode: currentTeam.code,
                sender: currentUser.name
            });

            showLocalNotification('üö® –¢–†–ï–í–û–ì–ê!\n\n–°–∏–≥–Ω–∞–ª –∑–∞—â–∏—Ç—ã –±–∞–∑—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤—Å–µ–º!');
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–π–¥-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function handleRaidNotification(data) {
            addNotificationToList(data, true);
            playAlarmSound();
            vibrate([200, 100, 200, 100, 200]);
            
            showLocalNotification(`üö® ${data.type.toUpperCase()} –æ—Ç ${data.sender}!\n\n${data.message}${data.coords ? `\n–ö–æ–æ—Ä–¥—ã: ${data.coords}` : ''}`);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞—â–∏—Ç—ã
        function handleDefenseNotification(data) {
            addNotificationToList(data, true);
            playAlarmSound();
            vibrate([500, 200, 500, 200, 500]);
            
            showLocalNotification(`üö® –ë–ê–ó–ê –ü–û–î –ê–¢–ê–ö–û–ô!\n\n–û—Ç: ${data.sender}\n\n–í—Å–µ –∫ –±–∞–∑–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ!`);
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Å–ø–∏—Å–æ–∫
        function addNotificationToList(notification, isUrgent = false) {
            document.getElementById('notifications').style.display = 'block';
            const list = document.getElementById('notificationsList');
            
            const div = document.createElement('div');
            div.className = `notification ${isUrgent ? 'urgent' : ''}`;
            
            let typeText = '';
            if (notification.type === 'raid' || notification.type === 'online-raid') typeText = '‚öîÔ∏è –û–ù–õ–ê–ô–ù –†–ï–ô–î';
            else if (notification.type === 'offline-raid') typeText = 'üåô –û–§–§–õ–ê–ô–ù –†–ï–ô–î';
            else if (notification.type === 'counter-raid') typeText = 'üõ°Ô∏è –ö–ê–£–ù–¢–ï–† –†–ï–ô–î';
            else if (notification.type === 'farm') typeText = '‚õèÔ∏è –§–ê–†–ú';
            else if (notification.type === 'defense') typeText = 'üö® –ó–ê–©–ò–¢–ê –ë–ê–ó–´';

            div.innerHTML = `
                <div class="notification-type">${typeText}</div>
                <div class="notification-message">${notification.message}</div>
                <div class="notification-details">
                    üë§ ${notification.sender} ‚Ä¢ ‚è∞ ${new Date(notification.timestamp).toLocaleTimeString()}
                </div>
            `;
            
            list.insertBefore(div, list.firstChild);
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            while (list.children.length > 10) {
                list.removeChild(list.lastChild);
            }
        }

        // –ó–≤—É–∫ —Å–∏—Ä–µ–Ω—ã
        function playAlarmSound() {
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT');
                audio.play().catch(e => console.log('–ó–≤—É–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'));
            } catch (e) {
                console.log('–ó–≤—É–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
            }
        }

        // –í–∏–±—Ä–∞—Ü–∏—è
        function vibrate(pattern = [0, 500, 200, 500]) {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        }

        // –õ–æ–∫–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showLocalNotification(message) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('ü¶Ä Rust Raid System', {
                    body: message,
                    icon: '/icon-192.png',
                    badge: '/icon-192.png',
                    tag: 'rust-raid',
                    requireInteraction: true
                });
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        async function setupPushNotifications() {
            if ('serviceWorker' in navigator && 'PushManager' in window) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        console.log('Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω—ã');
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ SW:', error);
                }
            }
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã
        function copyTeamCode() {
            if (currentTeam) {
                navigator.clipboard.writeText(currentTeam.code).then(() => {
                    alert(`üìã –ö–æ–¥ –∫–æ–º–∞–Ω–¥—ã ${currentTeam.code} —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!`);
                }).catch(() => {
                    alert(`–ö–æ–¥ –∫–æ–º–∞–Ω–¥—ã: ${currentTeam.code}`);
                });
            }
        }

        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>
